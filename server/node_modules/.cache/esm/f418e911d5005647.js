let userModel,hashpassword,comparePassword;_d50‍.x([["register",()=>register],["login",()=>login]]);_d50‍.w("../models/userModel",[["default",["userModel"],function(v){userModel=v}]]);_d50‍.w("./../utils/auth",[["hashpassword",["hashpassword"],function(v){hashpassword=v}],["comparePassword",["comparePassword"],function(v){comparePassword=v}]]);

const jwt = require("jsonwebtoken");

       const register = async (req, res) => {
  try {
    const { firstName, lastName, email, password, contact, address } = {
      ...req.body,
    };

    if (!firstName) {
      return res
        .status(404)
        .json({ status: "Failed", message: "Please enter first name" });
    }

    if (!lastName) {
      return res
        .status(404)
        .json({ status: "Failed", message: "Please enter last name" });
    }

    let userExist = await userModel.findOne({ email });
    if (userExist) {
      return res
        .status(400)
        .json({ status: "Failed", message: "Email is taken" });
    }

    // hashpassword

    const hashedPassword = await hashpassword(password);

    // Save the data to the database
    await userModel.create({
      firstName,
      lastName,
      email,
      password: hashedPassword,
      contact,
      address,
    });
    res.status(201).json({ message: "successfully sent the data" });
  } catch (error) {
    _d50‍.g.console.log(error.message);
  }
};

       const login = async (req, res) => {
  const { email, password } = { ...req.body };
  _d50‍.g.console.log(email);
  jwt.sign(
    { user: { email: email, password: password } },
    "secret-key",
    async (err, token) => {
      const user = await userModel.findOne({ email }).exec();
      _d50‍.g.console.log(user);

      if (comparePassword(hashpassword(password), user.password)) {
        res.status(200).json({ token });
      } else {
        res.status(400).json("Wrong password");
      }
    }
  );
};
